<!DOCTYPE html>
<html>

<head>
    <title>Qmanca? Calcola giorni, date, età!</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta title="Quanto manca? Che giorno sarà? Quanti anni ha? Qmanca calcola scadenze, date ed età in un istante!">
    <meta name="description" content="Qmanca è un'applicazione semplice ma molto utile che ti permette di calcolare quanti giorni mancano ad una certa data oppure che data sarà tra n giorni. Qmanca può anche calcolare quanti anni ha una persona inserendo la data o anno di nascita.">
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sofia&display=swap" rel="stylesheet">
    <!-- Google Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style>
        :root {
            --mg-white: #fdfdfd;
            --mg-black: #111111;
            --mg-dark: #202124;
            --mg-risultato: #eeeeee;
        }

        * {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 16px;
            line-height: 1.5;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 0.4em 0;
            font-weight: 400;
        }

        p {
            margin: 0.5em 0;
        }

        a {
            color: #000;
            text-decoration: none;
            -webkit-tap-highlight-color: transparent;
        }

        input,
        button {
            margin: 5px;
            padding: 5px 10px;
            height: 45px;
            font-size: large;
            vertical-align: middle;
            border-radius: 5px;
            border: 1px solid #000;
            background-color: #fafafa;
        }

        input {
            color: #000;
        }

        button {
            background-color: #000;
            color: #FFF;
            cursor: pointer
        }

        /* temi colorati */
        .tema1 {
            background-color: #B3DEE2;
        }

        .tema2 {
            background-color: #EAF2D7;
            background-image: url("assets/sfondi/icons_alberi.png");
        }

        .tema3 {
            background-color: #EFCFE3;
        }

        .tema4 {
            background-color: #EA9AB2;
        }

        .tema5 {
            background-color: #E27396;

            #app-menu a,
            #footer {
                color: var(--mg-white);
            }

        }

        /* tema Dark Mode */
        .dark-mode {
            background-color: var(--mg-dark);
            color: var(--mg-white);
        }

        .dark-mode a {
            color: var(--mg-white);
        }

        .dark-mode .app-main-section-block {
            background-color: var(--mg-black);
        }

        .dark-mode button {
            background-color: var(--mg-dark);
        }

        .dark-mode #sidebar-container {
            background-color: var(--mg-black);
        }

        .dark-mode .risultato {
            background-color: var(--mg-dark);
        }

        .dark-mode .icon-button:before {
            background-color: #FFF;
        }

        /* custom mg */
        .mg-sofia {
            font-family: 'Sofia', cursive;
        }

        .mg-show {
            display: block;
        }

        .mg-hide {
            display: none;
        }

        /* stuttura */
        #sidebar-container {
            display: flex;
            flex-direction: row;
            justify-content: flex-end;
            align-items: flex-start;
            position: fixed;
            top: 0;
            right: 0;
            z-index: 1;
            height: 100%;
            width: 0;
            max-width: 360px;
            overflow-x: hidden;
            background-color: var(--mg-white);
            transition: 0.1s ease-in-out;
            border-radius: 20px 0 0 20px;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }

        #sidebar-main {
            padding: 20px;
            width: 100%;
            height: 100%;
            overflow: auto;
        }

        #sidebar-menu,
        #app-menu {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 70px;
            min-width: 70px;
            padding: 5px;

        }

        #app-container {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: flex-end;
        }

        #app-main {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-left: 70px;
            padding: 0;
            width: 100%;
        }

        .app-main-section {
            margin: 10px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .app-main-section-block {
            padding: 20px;
            border-radius: 20px;
            background-color: var(--mg-white);
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            text-align: center;
        }

        #risultato-container {
            margin-top: 40px;
        }

        .risultato {
            margin: 10px 0;
            padding: 10px;
            background-color: var(--mg-risultato);
            border-radius: 20px;
        }

        .icon-button {
            position: relative;
            padding: 15px;
            font-size: 28px;
        }

        .icon-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            opacity: 0;
            transition: opacity 300ms;
            border-radius: 50%;
        }

        .icon-button:hover:before {
            opacity: 0.1;
        }

        @media only screen and (max-width: 768px) {

            #app-container,
            #sidebar-container {
                flex-direction: column-reverse;
                align-items: flex-end;
            }

            #app-main {
                margin-left: 0;
                padding: 10px;
            }

            #app-menu {
                flex-direction: row-reverse;
                justify-content: flex-start;
                width: 100%;
            }
        }

        /* animazione css */
        @keyframes tada {
            0% {
                transform: scale3d(1, 1, 1);
            }

            10%,
            20% {
                transform: scale3d(.9, .9, .9) rotate3d(0, 0, 1, -1deg);
            }

            30%,
            50%,
            70%,
            90% {
                transform: scale3d(1, 1, 1) rotate3d(0, 0, 1, 1deg);
            }

            40%,
            60%,
            80% {
                transform: scale3d(1, 1, 1) rotate3d(0, 0, 1, -1deg);
            }

            100% {
                transform: scale3d(1, 1, 1);
            }
        }

        .mg-tada {
            animation-name: tada;
            animation-duration: 1s;
            animation-iteration-count: 1;
        }

        #footer {
            margin: 20px;
            text-align: center;
        }
    </style>

</head>

<body class="tema1">
    <div id="sidebar-container">
        <div id="sidebar-main">
            <h1 class="mg-sofia">Qmanca?</h1>
            <p>Qmanca è un'applicazione semplice ma molto utile che ti permette di calcolare <strong>quanti giorni mancano</strong> ad una certa data oppure <strong>che data sarà tra "n" giorni</strong>. Qmanca può anche calcolare <strong>quanti anni ha una persona</strong> inserendo la data o anno di nascita.</p>
            <h1 class="mg-sofia">Da Tastiera</h1>
            <p>Puoi usare queste scorciatoie da tastiera:
            <ul>
                <li>"ctrl + 1" per calcolare quanti giorni mancano</li>
                <li>"ctrl + 2" per calcolare una data futura</li>
                <li>"ctrl + 3" per calcolare l'età</li>
                <li>"r" per calcolare una nuova data</li>
                <li>"d" per il tema scuro</li>
                <li>"c" per cambiare colore dello sfondo</li>
                <li>"i" per aprire e chiudere questo pannello informativo</li>
            </ul>
            </p>
        </div>
        <div id="sidebar-menu"><a href="javascript:void(0)" onclick="closeNav()"><span class="material-symbols-outlined icon-button">close</span></a></div>
    </div>
    <div id="app-container">
        <div id="app-main">

            <div class="app-main-section">
                <div class="app-main-section-block" id="qmanca-giorni">
                    <h1 class="mg-sofia">Quanto manca?</h1>
                    <p>Inserisci una data per sapere quanti giorni mancano.</p>
                    <input type="date" id="data">
                    <button id="giorni-calcola" onclick="calcolaGiorni();">Calcola</button>
                    <div id="risultato-container" class="mg-hide">
                        <div id="risultato-block-1" class="risultato">
                            <h1 class="mg-sofia" id="qmanca-giorni-risultato1"></h1>
                        </div>
                        <div id="risultato-block-2" class="risultato mg-hide">
                            <small>oppure</small>
                            <h1 class="mg-sofia" id="qmanca-giorni-risultato2"></h1>
                            <small>approssimando un mese con 30 giorni e un anno con 365 giorni.</small>
                        </div>
                        <div><a href="javascript:location.reload();" title="inserisci nuova data"><span class="material-symbols-outlined icon-button">refresh</span></a></div>
                    </div>
                </div>
            </div>

            <div class="app-main-section">
                <div class="app-main-section-block" id="qmanca-data">
                    <h1 class="mg-sofia">Che giorno sarà?</h1>
                    <p>Inserisci il numero di giorni mancanti per calcolare una data futura.</p>
                    <input type="number" id="giorni-input" min="0" max="1000000" step="10">
                    <button id="data-calcola" onclick="calcolaData();">Calcola</button>
                    <div id="qmanca-data-risultato-blocco" class="mg-hide">
                        <div class="risultato">
                            <h1 class="mg-sofia" id="qmanca-data-risultato"></h1>
                        </div>
                        <div><a href="javascript:location.reload();" title="inserisci nuova numero"><span class="material-symbols-outlined icon-button">refresh</span></a></div>
                    </div>
                </div>
            </div>

            <div class="app-main-section">
                <div class="app-main-section-block" id="qmanca-eta">
                    <h1 class="mg-sofia">Quanti anni ha?</h1>
                    <p>Inserisci la data di nascita per calcolare l'età.</p>
                    <input type="date" id="qmanca-eta-input">
                    <button id="eta-calcola" onclick="calcolaEta();">Calcola</button>
                    <div id="qmanca-eta-risultato-blocco" class="mg-hide">
                        <div class="risultato">
                            <h1 class="mg-sofia" id="qmanca-eta-risultato"></h1>
                        </div>
                        <div><a href="javascript:location.reload();" title="inserisci nuova numero"><span class="material-symbols-outlined icon-button">refresh</span></a></div>
                    </div>
                </div>
            </div>


        </div>
        <div id="app-menu">
            <div><a href="javascript:void(0)" onclick="openNav()" title="informazioni"><span class="material-symbols-outlined icon-button">info</span></a></div>
            <div><a href="javascript:void(0)" onclick="darkMode()" title="dark mode"><span class="material-symbols-outlined icon-button" id="dark-toggle">dark_mode</span></a></div>
            <div><a href="javascript:void(0)" onclick="cambiaTema()" title="cambia tema"><span class="material-symbols-outlined icon-button">colors</span></a></div>
        </div>
    </div>
    <div id="footer"><small>mg@qmanca 2023</small></div>
    <script>

        // apri e chiudi sidebar
        function openNav() {
            document.getElementById("sidebar-container").style.width = "80%";
        }
        function closeNav() {
            document.getElementById("sidebar-container").style.width = "0";
        }

        // mostra o nascondi elementi
        function mostra(stato, id) {

            let elemento = document.getElementById(id);

            if (stato == 0) {
                elemento.classList.remove("mg-show");
                elemento.classList.add("mg-hide");
            } else if (stato == 1) {
                elemento.classList.remove("mg-hide");
                elemento.classList.add("mg-show")
            };
        }

        // aggiunge classe animazione .mg-tada e suono notifica
        function animazione(id) {

            // suono notifica
            var audio = new Audio('assets/audio/alert-pop.wav');
            //var audio = new Audio('assets/audio/john-pop.wav');
            audio.play();

            // animazione e scroll blocco
            let elemento = document.getElementById(id);
            elemento.classList.add("mg-tada");
            elemento.scrollIntoView();

            // rimuove la classe .mg-tada al termine dell'animazione
            elemento.addEventListener("animationend", function () {
                elemento.classList.remove("mg-tada");
            }, { once: true });

        }

        // controllo se il tema è impostato
        const currentTheme = localStorage.getItem("theme");
        const darkModeStatus = localStorage.getItem("dark-mode");

        if (currentTheme != null) {
            document.body.className = currentTheme;
        }
        if (darkModeStatus == "on") {
            document.body.classList.toggle("dark-mode");
            document.getElementById("dark-toggle").textContent = "light_mode";
        }

        // temi e indice
        const colors = ["tema1", "tema2", "tema3", "tema4", "tema5"];
        let index = 1;

        // funzione cambia tema
        function cambiaTema() {

            // rimuovo dark mode
            localStorage.removeItem("dark-mode");
            document.getElementById("dark-toggle").textContent = "dark_mode";

            // applico la classe del tema
            document.body.className = colors[index];

            // memorizzo tema in localStorage
            localStorage.setItem("theme", colors[index]);

            // indice
            index = (index + 1) % colors.length;
        }

        // funzione tema dark mode
        function darkMode() {

            document.body.classList.toggle("dark-mode");

            // localStorage e icona Dark Mode
            if (document.body.classList.contains("dark-mode")) {
                localStorage.setItem("dark-mode", "on");
                document.getElementById("dark-toggle").textContent = "light_mode";
            } else {
                localStorage.removeItem("dark-mode");
                document.getElementById("dark-toggle").textContent = "dark_mode";
            }

        };

        // funzioni da tastiera
        document.addEventListener("keydown", function (event) {

            // calcola giorni
            if (event.ctrlKey && event.key == "1") {
                document.getElementById("giori-calcola").click();
            }
            // calcola data
            if (event.ctrlKey && event.key == "2") {
                document.getElementById("data-calcola").click();
            }
            // calcola età
            if (event.ctrlKey && event.key == "3") {
                document.getElementById("eta-calcola").click();
            }
            // ricarica pagina
            if (event.key == "r") {
                location.reload();
            }
            // dark mode
            if (event.key == "d") {
                darkMode();
            }
            // cambia tema
            if (event.key == "c") {
                cambiaTema();
            }
            // mostra nascondi sidebar
            if (event.key == "i") {
                let width = document.getElementById("sidebar-container").offsetWidth;
                if (width == 0) {
                    openNav();
                } else {
                    closeNav();
                }
            }
        });

        // calcola giorni
        function calcolaGiorni() {

            // data di oggi
            const dataOggi = new Date();

            // data inserita -1 ora per correzione al formato data passato da input
            const dataInserita = new Date(document.getElementById('data').value);
            dataInserita.setHours(dataInserita.getHours() - 1);

            // millisecondi in un giorno
            let msGiorno = 1000 * 60 * 60 * 24;

            // calcola la differenza in giorni
            let differenzaGiorni = Math.ceil((dataInserita - dataOggi) / msGiorno);

            // blocchi risultati e animazione
            mostra(1, 'risultato-container');
            mostra(0, 'risultato-block-2');
            animazione('qmanca-giorni');

            // risultato in giorni
            if (isNaN(differenzaGiorni)) {
                document.getElementById('qmanca-giorni-risultato1').textContent = 'Inserisci una data valida!';
            } else if (differenzaGiorni === 0) {
                document.getElementById('qmanca-giorni-risultato1').textContent = 'È oggi!';
            } else if (differenzaGiorni < 1) {
                document.getElementById('qmanca-giorni-risultato1').textContent = 'Inserisci una data futura 🙃';
            } else if (differenzaGiorni === 1) {
                document.getElementById('qmanca-giorni-risultato1').textContent = 'È domani!';
            } else {
                document.getElementById('qmanca-giorni-risultato1').textContent = 'Mancano ' + differenzaGiorni + ' giorni';
            }

            if (differenzaGiorni >= 7) {
                mostra(1, 'risultato-block-2');

                // differenza per calcolo anni, mesi, settimane, giorni
                let differenzaGiorniOppure = Math.abs(differenzaGiorni);

                // calcolo approssimato in anni, mesi, settimane, giorni
                let anni = Math.floor(differenzaGiorniOppure / 365);
                let mesi = Math.floor((differenzaGiorniOppure % 365) / 30);
                let settimane = Math.floor(((differenzaGiorniOppure % 365) % 30) / 7);
                let giorniRimasti = Math.floor(((differenzaGiorniOppure % 365) % 30) % 7);

                // risultato approssimato in anni, mesi, settimane, giorni
                if (anni != 0 && mesi == 0 && settimane == 0) {
                    document.getElementById("qmanca-giorni-risultato2").innerHTML = anni + " anni<br/>" + giorniRimasti + " giorni</br>";
                } else if (anni != 0 && mesi == 0) {
                    document.getElementById("qmanca-giorni-risultato2").innerHTML = anni + " anni<br/>" + settimane + " settimane</br>" + giorniRimasti + " giorni</br>";
                } else if (anni != 0) {
                    document.getElementById("qmanca-giorni-risultato2").innerHTML = anni + " anni<br/>" + mesi + " mesi</br>" + settimane + " settimane</br>" + giorniRimasti + " giorni</br>";
                } else if (mesi != 0 && settimane == 0) {
                    document.getElementById("qmanca-giorni-risultato2").innerHTML = mesi + " mesi</br>" + giorniRimasti + " giorni";
                } else if (mesi != 0) {
                    document.getElementById("qmanca-giorni-risultato2").innerHTML = mesi + " mesi</br>" + settimane + " settimane</br>" + giorniRimasti + " giorni";
                }
                else if (settimane != 0 && giorniRimasti == 0) {
                    document.getElementById("qmanca-giorni-risultato2").innerHTML = settimane + " settimane<br/>";
                } else if (settimane != 0) {
                    document.getElementById("qmanca-giorni-risultato2").innerHTML = settimane + " settimane<br/>" + giorniRimasti + " giorni";
                }
            }
        }

        function calcolaData() {

            // ottieni il numero di giorni inserito dall'utente
            let giorniInput = document.getElementById("giorni-input").value;

            // da stringa a numero intero
            let numeroGiorni = parseInt(giorniInput);

            // ottieni la data attuale
            const dataAttuale = new Date();

            // calcola la data futura
            const dataFutura = new Date();
            dataFutura.setDate(dataAttuale.getDate() + numeroGiorni);

            // formatta la data
            let formatoData = { year: 'numeric', month: 'long', day: 'numeric' };
            let dataFuturaFormattata = dataFutura.toLocaleDateString('it-IT', formatoData);

            // verifica l'input e mostra il risultato
            mostra(1, 'qmanca-data-risultato-blocco')
            animazione('qmanca-data');

            if (giorniInput === "" || numeroGiorni <= 0) {
                document.getElementById('qmanca-data-risultato').textContent = 'Inserisci un numero valido!';
                return;
            } else {
                document.getElementById('qmanca-data-risultato').textContent = dataFuturaFormattata;
            }
        }

        function calcolaEta() {

            // oggi
            const oggi = new Date();

            // data di nascita
            let dataNascita = document.getElementById('qmanca-eta-input').value;
            dataNascita = new Date(dataNascita);

            // differenza anni
            let differenzaAnni = oggi.getFullYear() - dataNascita.getFullYear();

            // differenza mesi e segno differenza date (positiva = futuro))
            let differenzaMesi = oggi.getMonth() - dataNascita.getMonth();
            let differenzaDate = Math.sign(oggi - dataNascita);

            // blocco risultato
            mostra(1, 'qmanca-eta-risultato-blocco')
            animazione('qmanca-eta');

            // controlli
            if (isNaN(differenzaAnni) || differenzaDate < 0) {
                document.getElementById('qmanca-eta-risultato').textContent = "Inserisci una data di nascita valida!";
                return;
            } else if (oggi.getMonth() < dataNascita.getMonth() || (oggi.getMonth() === dataNascita.getMonth() && oggi.getDate() < dataNascita.getDate())) {
                differenzaAnni--;
            }
            if (differenzaAnni == 0 && differenzaMesi >= 0) {
                document.getElementById('qmanca-eta-risultato').textContent = "0 anni 🍼";
                return;
            }

            // risultato
            document.getElementById('qmanca-eta-risultato').textContent = differenzaAnni + " anni";
        }

    </script>
</body>

</html>